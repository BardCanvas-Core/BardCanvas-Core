<FilesMatch "\.inc$|\.xml$">
deny from all
</FilesMatch>

Options -Indexes

ReWriteEngine On

ReWriteRule ^(.*)\~v.*\.js$  $1.js  [QSA,L]
ReWriteRule ^(.*)\~v.*\.css$ $1.css [QSA,L]

# Post indexes by category
ReWriteRule ^category/(.*)/media/$ gallery/by_category.php?slug=$1 [QSA,L]
ReWriteRule ^category/(.*)/media$  gallery/by_category.php?slug=$1 [QSA,L]
ReWriteRule ^category/(.*)/$       posts/by_category.php?slug=$1   [QSA,L]
ReWriteRule ^category/(.*)$        posts/by_category.php?slug=$1   [QSA,L]

# User profile resources
ReWriteRule ^user/(.*)/avatar/$         scripts/get_user_profile_resource.php?slug=$1&type=avatar         [QSA,L]
ReWriteRule ^user/(.*)/avatar$          scripts/get_user_profile_resource.php?slug=$1&type=avatar         [QSA,L]
ReWriteRule ^user/(.*)/profile_banner/$ scripts/get_user_profile_resource.php?slug=$1&type=profile_banner [QSA,L]
ReWriteRule ^user/(.*)/profile_banner$  scripts/get_user_profile_resource.php?slug=$1&type=profile_banner [QSA,L]

# Author archives
ReWriteRule ^author/(.*)/media/$   gallery/by_author.php?slug=$1             [QSA,L]
ReWriteRule ^author/(.*)/media$    gallery/by_author.php?slug=$1             [QSA,L]
ReWriteRule ^author/(.*)/videos/$  gallery/by_author.php?slug=$1&type=videos [QSA,L]
ReWriteRule ^author/(.*)/videos$   gallery/by_author.php?slug=$1&type=videos [QSA,L]
ReWriteRule ^author/(.*)/images/$  gallery/by_author.php?slug=$1&type=images [QSA,L]
ReWriteRule ^author/(.*)/images$   gallery/by_author.php?slug=$1&type=images [QSA,L]
ReWriteRule ^author/(.*)/posts/$   posts/by_author.php?slug=$1               [QSA,L]
ReWriteRule ^author/(.*)/posts$    posts/by_author.php?slug=$1               [QSA,L]

# Media archives
ReWriteRule ^date/([0-9]{4}/[0-9]{2}/[0-9]{2})/media/$ gallery/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4}/[0-9]{2}/[0-9]{2})/media$  gallery/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4}/[0-9]{2})/media/$          gallery/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4}/[0-9]{2})/media$           gallery/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4})/media/$                   gallery/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4})/media$                    gallery/by_date.php?date=$1 [QSA,L]

# Post archives
ReWriteRule ^date/([0-9]{4}/[0-9]{2}/[0-9]{2})/$ posts/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4}/[0-9]{2}/[0-9]{2})$  posts/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4}/[0-9]{2})/$          posts/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4}/[0-9]{2})$           posts/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4})/$                   posts/by_date.php?date=$1 [QSA,L]
ReWriteRule ^date/([0-9]{4})$                    posts/by_date.php?date=$1 [QSA,L]

# Media server
ReWriteRule ^mediaserver/(.*)$       data/uploaded_media/$1 [QSA,L]
ReWriteRule ^mediaserver-embed/(.*)$ scripts/mediaserver_embed.php?file=$1 [QSA,L]

#
# Document handler - for all those that support single documents
# This ruleset must be the last in the .htaccess file
#

RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
ReWriteRule .* - [L]
 
ReWriteRule ^(.+)/$ scripts/document_handler.php?REQUEST_FILENAME=%{REQUEST_FILENAME}&handle=$1 [QSA,L]
ReWriteRule ^(.+)$  scripts/document_handler.php?REQUEST_FILENAME=%{REQUEST_FILENAME}&handle=$1 [QSA,L]
